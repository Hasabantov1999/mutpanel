generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Note: SQLite doesn't support enums, using String fields instead
// Role: "ADMIN" | "USER"
// MutStatus: "PENDING" | "APPROVED" | "REJECTED"

model Panel {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
}

model User {
  id            String    @id @default(cuid())
  username      String    @unique
  firstName     String
  lastName      String
  email         String    @unique
  password      String
  role          String    @default("USER") // ADMIN or USER
  panelId       String?
  panel         Panel?    @relation(fields: [panelId], references: [id])
  createdById   String?
  createdBy     User?     @relation("CreatedUsers", fields: [createdById], references: [id])
  createdUsers  User[]    @relation("CreatedUsers")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  muts          Mut[]
  approvedMuts  Mut[]     @relation("ApprovedMuts")
  notifications Notification[]
}

model Mut {
  id               String    @id @default(cuid())
  panelYatirim     Float     @default(0)
  panelCekim       Float     @default(0)
  devir            Float     @default(0)
  komisyonOrani    Float     @default(1.25)
  status           String    @default("PENDING") // PENDING, APPROVED, REJECTED
  approvedById     String?
  approvedBy       User?     @relation("ApprovedMuts", fields: [approvedById], references: [id])
  approvedAt       DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  userId           String
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  manuelYatirimlar ManuelYatirim[]
  manuelCekimler   ManuelCekim[]
}

model ManuelYatirim {
  id        String   @id @default(cuid())
  isim      String
  miktar    Float
  mutId     String
  mut       Mut      @relation(fields: [mutId], references: [id], onDelete: Cascade)
}

model ManuelCekim {
  id        String   @id @default(cuid())
  isim      String
  miktar    Float
  mutId     String
  mut       Mut      @relation(fields: [mutId], references: [id], onDelete: Cascade)
}

model Notification {
  id        String   @id @default(cuid())
  message   String
  type      String   // MUT_APPROVED, MUT_REJECTED, USER_CREATED
  read      Boolean  @default(false)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  mutId     String?
  createdAt DateTime @default(now())
}
